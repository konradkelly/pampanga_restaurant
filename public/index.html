<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pampangan Restaurant ‚Äî Filipino Kitchen</title>
  <meta name="description" content="Authentic Pampangan Filipino restaurant with tropical palette, menu filtering, specials, reviews, and reservations." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="#top" aria-label="Home">
        <div class="brand__logo" aria-hidden="true">PR</div>
        <div class="brand__name">Pampangan Restaurant</div>
      </a>
      <nav aria-label="Primary">
        <ul>
          <li><a href="#menu">Menu</a></li>
          <li><a href="#specials">Specials</a></li>
          <li><a href="#about">Our Story</a></li>
          <li><a href="#visit">Visit</a></li>
        </ul>
      </nav>
  <button id="reserveBtn" type="button" class="cta" aria-controls="reserveModal">Reserve</button>
    </div>
  </header>

  <main>
    <!-- Hero Section -->
    <section class="hero" id="top">
      <div class="container hero__inner">
        <div>
          <span class="chip">üçΩÔ∏è Pampangan Flavors</span>
          <h1>Where tradition meets taste in every gathering.</h1>
          <p>Slow-simmered adobo, bright calamansi, smoky inihaw, and sweet halo-halo‚Äîcrafted with love and shared with joy.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <button class="cta" onclick="scrollToId('menu')">View Menu</button>
            <button class="cta" onclick="scrollToId('specials')">Today's Special</button>
          </div>
        </div>
        <div class="hero__card" role="img" aria-label="Tropical abstract with mango and leaf hues">
          <div class="leaf-bar" aria-hidden="true"></div>
          <div class="specials-grid">
            <div class="special-card">
              <strong>Dish of the Day</strong>
              <p id="dishOfDay">Loading‚Ä¶</p>
              <div id="dishTags" class="pill-container"></div>
            </div>
            <div class="special-card">
              <strong>Hours</strong>
              <p>Mon‚ÄìThu: 11:00‚Äì21:00<br>Fri‚ÄìSat: 11:00‚Äì22:00<br>Sun: 11:00‚Äì20:00</p>
              <button class="cta" onclick="scrollToId('visit')">Get Directions</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Specials Section -->
    <section id="specials" class="container">
      <h2>Chef's Specials</h2>
      <p class="sub">A rotating selection inspired by home-cooked classics and seasonal produce.</p>
      <div class="specials">
        <div class="special-card">
          <strong>Kamayan Friday</strong>
          <p>Experience boodle fight dining‚Äîbanana leaves, grilled favorites, and eat with your hands. Share with friends!</p>
          <div class="special-grid" id="kamayanList"></div>
        </div>
        <div class="special-card">
          <strong>Fiesta Drinks</strong>
          <p>Refreshing sips featuring calamansi, ube, and coconut.</p>
          <ul>
            <li>Calamansi Cooler</li>
            <li>Ube Latte</li>
            <li>Buko Pandan Shake</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Menu Section -->
    <section id="menu" class="container">
      <h2>Menu</h2>
      <div class="menu-controls" role="tablist" aria-label="Menu filters">
        <button class="tab active" data-filter="all" role="tab">All</button>
        <button class="tab" data-filter="appetizer" role="tab">Appetizers</button>
        <button class="tab" data-filter="main" role="tab">Mains</button>
        <button class="tab" data-filter="dessert" role="tab">Desserts</button>
        <button class="tab" data-filter="drinks" role="tab">Drinks</button>
      </div>
      <div class="menu-grid" id="menuGrid" aria-live="polite"></div>
    </section>

    <!-- About Section -->
    <section id="about" class="container">
      <h2>Our Story</h2>
      <div class="about">
        <div class="story">
          <p>Rooted in Pampangan culinary tradition‚Äîwe cook the way our families taught us: generous portions, bold flavors, and a table for everyone.</p>
          <p>We source locally when we can and import essentials like bagoong, patis, and authentic vinegars to honor tradition.</p>
          <div class="pill-container">
            <span class="pill">Family Recipes</span>
            <span class="pill">Local Produce</span>
            <span class="pill">Kamayan</span>
          </div>
        </div>
        <div class="story">
          <strong>Tell your friends!</strong>
          <p>Leave a review or tag us on social‚Äîyour support helps small, local kitchens like ours thrive.</p>
          <button class="cta" onclick="scrollToId('reviews')">See Reviews</button>
        </div>
      </div>
    </section>

    <!-- Reviews Section -->
    <section id="reviews" class="container">
      <h2>Community Reviews</h2>
      <div class="reviews">
        <div class="review-track" id="reviewTrack" aria-label="Customer reviews">
          <!-- JS injected reviews -->
        </div>
        <div class="foot-card">
          <strong>Rate your visit</strong>
          <p>We'd love to hear from you. Share your favorites!</p>
          <button class="cta" onclick="alert('Thank you for your support!')">Leave a Review</button>
        </div>
      </div>
    </section>



    <!-- Visit & Reservation Section -->
    <section id="visit" class="container">
      <h2>Reserve a Table</h2>
        <div>
          <p>Book your table ahead to secure your spot. Click the button to open the reservation form.</p>
          <button id="openReserve" type="button" aria-controls="reserveModal" class="cta">Reserve Now!</button>
        </div>
      <div class="foot">
        <div class="foot-card">
          <strong>Visit Us</strong>
          <p>123 Mango Ave, Your City, CA</p>
          <iframe src="https://www.google.com/maps/embed?pb=..." width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
          <p><strong>Call:</strong> (555) 123-4567</p>
        </div>
        <div class="foot-card">
          <strong>Hours</strong>
          <p>Mon‚ÄìThu: 11:00‚Äì21:00<br>Fri‚ÄìSat: 11:00‚Äì22:00<br>Sun: 11:00‚Äì20:00</p>
          <p><strong>Follow:</strong> @pampanganrestaurant</p>
        </div>
      </div>

      <!-- Reservation Modal -->
      <div id="reserveModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="reserveTitle">
        <div class="modal__overlay" data-close></div>
        <div class="modal__panel">
          <button class="modal__close" aria-label="Close reservation form" data-close>&times;</button>
          <h3 id="reserveTitle">Reserve a Table</h3>
          <form id="reservationForm">
            <div class="form-group">
              <label for="guestName">Name</label>
              <input type="text" id="guestName" name="guestName" placeholder="Your Name" required>
            </div>
            <div class="form-group">
              <label for="guestEmail">Email</label>
              <input type="email" id="guestEmail" name="guestEmail" placeholder="Your Email" required>
            </div>
            <div class="form-group">
              <label for="guestPhone">Phone</label>
              <input type="tel" id="guestPhone" name="guestPhone" placeholder="Your Phone" required>
            </div>
            <div class="form-row">
              <div class="col">
                <div class="form-group">
                  <label for="partySize">Party Size</label>
                  <input type="number" id="partySize" name="partySize" placeholder="Number of Guests" min="1" required>
                </div>
              </div>
              <div class="col stack">
                <div class="form-group">
                  <label for="date">Date</label>
                  <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                  <label for="time">Time</label>
                  <input type="time" id="time" name="time" required>
                </div>
              </div>
            </div>
            <div style="display:flex; gap:8px; margin-top:12px;">
              <button type="submit" class="cta">Reserve</button>
              <button type="button" data-close class="cta" style="background:#ccc;color:#000;">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script src="/api.js"></script>
  <script src="/client.js"></script>
  <script>
    // Modal handling for reservation form with focus-trap and stronger event handling
    (function(){
      const openBtn = document.getElementById('openReserve');
      const headerReserve = document.getElementById('reserveBtn');
      const modal = document.getElementById('reserveModal');
      const closeEls = modal.querySelectorAll('[data-close]');
      const form = document.getElementById('reservationForm');
      const main = document.querySelector('main');
      let lastActive = null;

      // Utility: return focusable elements within modal
      function getFocusable() {
        return Array.from(modal.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'))
          .filter(el => el.offsetParent !== null);
      }

      function openModal(e){
        if (e && typeof e.preventDefault === 'function') {
          e.preventDefault();
          e.stopPropagation();
        }
        lastActive = document.activeElement;
        modal.setAttribute('aria-hidden', 'false');
        // Hide main content from assistive tech while modal is open
        if (main) main.setAttribute('aria-hidden', 'true');
        // Prevent page scroll behind modal
        document.body.style.overflow = 'hidden';

        // Focus the first focusable control without triggering automatic scrolling.
        const focusables = getFocusable();
        const first = focusables[0];
        requestAnimationFrame(() => {
          try {
            if (first && typeof first.focus === 'function') {
              first.focus({ preventScroll: true });
            }
          } catch (err) {
            if (first && typeof first.focus === 'function') first.focus();
          }
        });
      }

      function closeModal(){
        modal.setAttribute('aria-hidden', 'true');
        if (main) main.removeAttribute('aria-hidden');
        document.body.style.overflow = '';
        if(lastActive && typeof lastActive.focus === 'function') {
          try { lastActive.focus({ preventScroll: true }); }
          catch { lastActive.focus(); }
        }
      }

      // Focus trap: keep Tab / Shift+Tab inside modal
      function handleKeyDown(e){
        if (modal.getAttribute('aria-hidden') === 'true') return;
        if (e.key === 'Escape') { e.preventDefault(); closeModal(); return; }

        if (e.key === 'Tab') {
          const focusables = getFocusable();
          if (focusables.length === 0) {
            e.preventDefault();
            return;
          }
          const first = focusables[0];
          const last = focusables[focusables.length - 1];
          if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault(); first.focus();
          } else if (e.shiftKey && document.activeElement === first) {
            e.preventDefault(); last.focus();
          }
        }
      }

      // Ensure overlay and close buttons close the modal
      closeEls.forEach(el => el.addEventListener('click', (ev) => { ev.preventDefault(); closeModal(); }));

      // Close on overlay click
      modal.addEventListener('click', (e) => {
        if (e.target === modal.querySelector('.modal__overlay')) { e.preventDefault(); closeModal(); }
      });

      // Attach open handlers with strong preventDefault to avoid any default anchor/scroll behavior
      if (openBtn) openBtn.addEventListener('click', openModal);
      if (headerReserve) headerReserve.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); openModal(e); });

      // Global keydown for focus trap and escape
      window.addEventListener('keydown', handleKeyDown);

      // Keep existing form submit handlers elsewhere working; don't intercept here.
      if (form) form.addEventListener('submit', (e) => {
        // No-op: submission handled by client.js/PampanganAPI; you can close modal on success via event or callback.
      });
    })();
  </script>
</body>
</html>
